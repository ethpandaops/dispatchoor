# dispatchoor configuration example
# Copy this file to config.yaml and customize as needed.

server:
  listen: ":9090"
  cors_origins:
    - "*"

database:
  driver: sqlite
  sqlite:
    path: ./dispatchoor.db
  # For PostgreSQL:
  # driver: postgres
  # postgres:
  #   host: localhost
  #   port: 5432
  #   user: dispatchoor
  #   password: ${DB_PASSWORD}
  #   database: dispatchoor
  #   sslmode: disable

github:
  token: ${GITHUB_TOKEN}
  # Optional: separate token for listing runners (falls back to token if not set)
  # runners_token: ${GITHUB_RUNNERS_TOKEN}
  poll_interval: 60s
  rate_limit_buffer: 100

dispatcher:
  enabled: true
  interval: 30s
  tracking_interval: 30s

auth:
  session_ttl: 24h
  basic:
    enabled: true
    users:
      - username: admin
        password: ${ADMIN_PASSWORD}
        role: admin
      - username: viewer
        password: ${VIEWER_PASSWORD}
        role: readonly
  github:
    enabled: false
    client_id: ${GITHUB_CLIENT_ID}
    client_secret: ${GITHUB_CLIENT_SECRET}
    # URL to redirect to after successful login (e.g., your UI URL)
    redirect_url: http://localhost:3000
    # Role mappings control both access and permissions.
    # Users must be in at least one mapping to log in.
    org_role_mapping:
      ethpandaops: admin
    # Map individual GitHub usernames to roles (case-insensitive)
    # user_role_mapping:
    #   octocat: admin

# History retention settings for job cleanup
history:
  retention_days: 30   # Days to keep completed/failed/cancelled jobs (default: 30, -1 to disable)
  cleanup_interval: 1h # How often to run cleanup (default: 1h)

# Groups define runner pools and their dispatchable workflow templates
groups:
  github:
    - id: sync-tests
      name: Sync Tests
      description: Ethereum sync testing jobs
      runner_labels:
        - self-hosted
        - synctest
        - Disk2TB
      # Templates can be defined inline, loaded from local files, or fetched from remote URLs:
      # workflow_dispatch_templates_files:
      #   - templates/hoodi.yaml
      #   - templates/mainnet.yaml
      # workflow_dispatch_templates_urls:
      #   - https://raw.githubusercontent.com/myorg/templates/main/sync-tests.yaml
      # All sources can be used together - file and URL templates are appended to inline templates.
      workflow_dispatch_templates:
        - id: sync-test-hoodi-geth-prysm
          name: Sync Test (Hoodi) - geth/prysm
          owner: ethpandaops
          repo: syncoor-tests
          workflow_id: syncoor.yaml
          ref: master
          inputs:
            run-timeout-minutes: "1380"
            el-client: '"geth"'
            cl-client: '"prysm"'
            config: >-
              {
                "network": "hoodi",
                "consensus": {
                  "syncType": "checkpoint",
                  "nodeType": "fullnode",
                  "images": {
                    "prysm": "gcr.io/offchainlabs/prysm/beacon-chain:stable"
                  }
                },
                "execution": {
                  "images": {
                    "geth": "ethereum/client-go:stable"
                  }
                }
              }
